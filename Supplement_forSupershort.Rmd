---
bibliography: manuscript.bib
csl: systematic-biology.csl
site: "bookdown::bookdown_site"
output:
  bookdown::pdf_document2:
    toc: FALSE
indent: TRUE
monofont: "Times New Roman"
fontsize: 12pt
language:
  label:
    fig: "**Figure S**"
    tab: "**Table S**"
header-includes:
  - \usepackage[left]{lineno}
  - \linenumbers
  - \usepackage{setspace}
  - \doublespacing
---

```{r setup, include=FALSE}
	# Load packages
	## General
library(knitr)
library(tidyverse)
library(stringr)
library(reshape2)
	## Biological
library(Rphylip)
library(arbutus)
library(vegan)
library(ape)
library(phangorn)
library(phytools)
library(OUwie)
library(picante)
library(geiger)
library(phylobase)
library(fields)
library(phylosignal)
library(geomorph)
library(phylopath)
library(phylolm)
	## Graphics
library(FactoMineR)
library(factoextra)
library(corrplot)
library(BAMMtools)
library(gridExtra)
library(xtable)
library(colorRamps)

	# Configure knitr, see http://yihui.name/knitr/options
	opts_knit$set(
	  progress=TRUE,
	  verbose=TRUE)
	opts_chunk$set(
	#  include=FALSE,
	  cache=TRUE,
	  echo=FALSE,
	  message=FALSE
	 )
knitr::opts_chunk$set(echo = TRUE)

```

# Supplementary Materials File {-}

Alejandro Damian-Serrano, Steven H.D. Haddock, Casey W. Dunn

## Supplementary Methods {-}

DAPC optimization: Some taxa have inapplicable states for certain absent characters (such as the length of a nematocyst subtype that is not present in a species), which are problematic for DAPC analyses. We tackled this by transforming the absent states to zeroes. This approach allows us to incorporate all the data, but creates an attraction bias between small character states (*e.g.* small tentilla) and absent states (*e.g.* no tentilla). Absent characters are likely to be very biologically relevant to prey capture and we believe they should be accounted for in a predictive approach. We limited the number of linear discriminant functions retained to the number of groupings in each case. We selected the number of principal components retained using the a-score optimization function (R adegenet::optim.a.score) [@jombart2010discriminant] with 100 iterations, which yielded more stable results than the cross validation function (R adegenet::xval). This optimization aims to find the compromise value with highest discrimination power with the least overfitting.

## Supplementary Materials {-}

![\label{appendix2} Character definitions. ](Post-submission modifications/Supplementary_materials/Online_appendices/PNGs/Appendix2.png){height=500px}


Other trees inferred in this work include:

![\label{MLIqtree} Maximum likelihood IQTree inference, unconstrained. Node labels are bootstrap support values.](Post-submission modifications/Supplementary_materials/Online_appendices/PNGs/MLunconstrained.png){height=300px}

The constrained tree inferences utilized the following constrain topology:

![\label{Transcriptome_constraint} Topology used to constrain analyses (minimal topological statements based on the incongruences between the unconstrained tree and Munro et al. (2018). ](Post-submission modifications/Supplementary_materials/Online_appendices/PNGs/constrain.png){height=400px}

![\label{ML_constrained} Constrained IQTree ML inference. Node labels are bootstrap support values.](Post-submission modifications/Supplementary_materials/Online_appendices/PNGs/MLconstrained.png){height=300px}

![\label{Bayes_unconstrained} Unconstrained Bayesian topology inference in RevBayes (node labels are Bayesian posteriors).](Post-submission modifications/Supplementary_materials/Online_appendices/PNGs/BAYESunconstrained.png){height=300px}

![\label{Bayes_constrained} Clade constrained Bayesian inference in RevBayes (node labels are Bayesian posteriors).](Post-submission modifications/Supplementary_materials/Online_appendices/PNGs/BayesConstrained.png){height=300px}

![\label{unconstrained_timetree} Unconstrained ultrametric Bayesian time tree branch length and topology inference in RevBayes (node labels are Bayesian posteriors). Arbitrary rooting.).](Post-submission modifications/Supplementary_materials/Online_appendices/PNGs/Unconstrained timetree.png){height=400px}

![\label{constrained_timetree} Ultrametric Bayesian time tree branch length inference in RevBayes (node labels are bayesian posteriors). Topology clamped to the Bayesian constrained topology inference in \@ref{Bayes_constrained}. Tree rooted using outgroup constraint.](Post-submission modifications/Supplementary_materials/Online_appendices/PNGs/constrainedTimetree.png){height=500px}

\newpage

![\label{ModelSupport} Model support (delta AICc), phylogenetic signal (Blombergâ€™s K), and phylogenetic signal permutation test p-value for each continuous character. Ntaxa = Number of taxa used in the analyses after removing those where the character sate is inapplicable or the data is missing.](Post-submission modifications/Supplementary_materials/Online_appendices/PNGs/modelSupport.png){height=600px}

![\label{ModelAdequacy} Model adequacy scores for the best model supported for each morphological character. Cvar = coefficient of variation of the absolute value of the contrasts. Svar = Slope of a linear model fitted to the absolute value of the contrasts against their expected variances. Sasr = slope of the contrasts against the ancestral state inferred at each corresponding node. Shgt = slope of the contrasts against node depth. Dcfd = Kolmolgorov-Smirnov D-statistic comparing contrasts to a normal distribution with SD equal to the root of the mean of squared contrasts. ](Post-submission modifications/Supplementary_materials/Online_appendices/PNGs/modelAdequacy.png)

![\label{ModelSupportOUwie} Model support (delta AICc) for each morphological character analyzed on the feeding guild reconstruction regime tree. OU1 = Single-optimum Ornstein-Uhlenbeck. OUm = Multi-optima Ornstein-Uhlenbeck. Model adequacy scores calculated for the best supported model only. Msig = mean of squared contrasts. Cvar = coefficient of variation of the absolute value of the contrasts. Svar = Slope of a linear model fitted to the absolute value of the contrasts against their expected variances. Sasr = slope of the contrasts against the ancestral state inferred at each corresponding node. Shgt = slope of the contrasts against node depth. Dcfd = Kolmolgorov-Smirnov D-statistic comparing contrasts to a normal distribution with SD equal to the root of the mean of squared contrasts.](Post-submission modifications/Supplementary_materials/Online_appendices/PNGs/OUwie_modelsupport.png)

DAPC discriminant analyses:

![\label{DAPCguilds} DAPC for Feeding guilds. Six PCs retained after a-score optimization (100 iterations). Four LDA functions used. Discriminant power on training set: 100%. Prediction posterior distribution heat map in main text Figure 6. Variable contribution (top quartile) calculated by the sum of the LDA variable loadings weighted by the eigenvalue of each LDA.](Post-submission modifications/Supplementary_materials/Online_appendices/PNGs/DAPC_guilds.png){height=500px}

![\label{DAPCcopepods} DAPC for copepod presence in the diet. Eight PCs retained after a-score optimization (100 iterations). One LDA functions used. Discriminant power on training set: 95.4%. Grayscale heat map shows the posterior probability distribution of the predictions. Variable contribution (top quartile) calculated by the sum of the LDA variable loadings weighted by the eigenvalue of each LDA.](Post-submission modifications/Supplementary_materials/Online_appendices/PNGs/DAPC_copepod.png)

![\label{DAPCfish} DAPC for fish presence in the diet. Three PCs retained after a-score optimization (100 iterations). One LDA function used. Discriminant power on training set: 68.1%. Grayscale heat map shows the posterior probability distribution of the predictions. Variable contribution (top quartile) calculated by the sum of the LDA variable loadings weighted by the eigenvalue of each LDA.](Post-submission modifications/Supplementary_materials/Online_appendices/PNGs/DAPC_fish.png)

![\label{DAPCcrustacean} DAPC for large crustacean presence in the diet. Four PCs retained after a-score optimization (100 iterations). One LDA function used. Discriminant power on training set: 81.8%. Grayscale heat map shows the posterior probability distribution of the predictions. Variable contribution (top quartile) calculated by the sum of the LDA variable loadings weighted by the eigenvalue of each LDA.](Post-submission modifications/Supplementary_materials/Online_appendices/PNGs/DAPC_crustacean.png)

\newpage

Ordinary and phylogenetic logistic regression of morphological characters and the presence/absence of prey types:

![\label{GLMs} Logistic regressions between continuous morphological characters and prey type presences. Ntaxa = number of taxa used in the analyses after removing taxa with missing diet data and inapplicable character states. phyloGLM = Phylogenetic generalized logistic regression model. GLM = Generalized logistic regression model. P = p-value. b = slope. Only cases with significant GLM fits were retained. Cells colored blue indicate phyloGLM p-value < 0.05. Cells colored green indicate GLM p-value < 0.05](Post-submission modifications/Supplementary_materials/Online_appendices/PNGs/PhyloGLM.png){height=300px}

![\label{SIMMAPguilds} SIMMAP Feeding guilds.](Post-submission modifications/Supplementary_materials/Online_appendices/PNGs/guild_SIM.png)

\newpage

Variance-Covariance Matrix analyses of phenotypic intergation and evolutionary modularity:

![\label{VCV_NAZero} Rate covariance matrix for the whole tree using all taxa (45 species), transforming inapplicable states to zeroes. Covariances scaled to correlations. All characters estimated simultaneously under Brownian Motion.](Post-submission modifications/Supplementary_materials/Online_appendices/PNGs/VCV_Nazero.png)

![\label{VCV_NAremove} Rate covariance matrix for the whole tree using only taxa without inapplicable states (24 species). Covariances scaled to correlations. All characters estimated simultaneously under Brownian Motion.](Post-submission modifications/Supplementary_materials/Online_appendices/PNGs/VCV_NAremove.png)

![\label{VCV_dietaxa} Rate covariance matrix for the whole tree using only taxa with diet data (22 species), transforming inapplicable states to zeroes. Covariances scaled to correlations. All characters estimated simultaneously under Brownian Motion.](Post-submission modifications/Supplementary_materials/Online_appendices/PNGs/VCV_dietaxa.png)

![\label{VCV_bestmodels} Best models (lowest AIC) supported in a pairwise character rate covariance analysis comparing correlated Brownian Motion models across the five selective regimes. Selective regimes were mapped onto the tree using an ancestral state reconstruction of the feeding guilds. Blank cells represent computationally singular contrasts.](Post-submission modifications/Supplementary_materials/Online_appendices/PNGs/VCVbestModels.png)

![\label{VCV_ntaxa} Number of taxa used for each pairwise contrast in the VCV analyses, given the number of taxa without inapplicable states.](Post-submission modifications/Supplementary_materials/Online_appendices/PNGs/VCV_ntaxa.png)

![\label{VCV_regimes} Pairwise estimated rate covariance matrices across the five selective regimes, using only taxa with diet data. Covariances scaled to correlations. Selective regimes were mapped onto the tree (22 species with diet data) using a stochastic mapping of the feeding guilds. Tree is pruned to taxa with no inapplicable states for a given character pair. Not all regimes are represented in all contrasts. Question marks represent computationally singular contrasts.](Post-submission modifications/Supplementary_materials/Online_appendices/PNGs/VCV_regimes.png){height=600px}

![\label{VCV_diffs} Scaled differences between the regime-specific covariance matrices in \@ref{VCV_regimes} and the whole tree covariance matrix.](Post-submission modifications/Supplementary_materials/Online_appendices/PNGs/VCVdiffs.png){height=600px}

![\label{VCV_diffs_anc} Scaled differences between the regime-specific covariance matrices in \@ref{VCV_regimes} and the covariance matrices in their preceding regime, the large-crustacean specialist regime.](Post-submission modifications/Supplementary_materials/Online_appendices/PNGs/VCVdiffs_anc.png)

## References {-}

